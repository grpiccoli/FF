function d3LineWithLegend(){function n(y){return y.each(function(p){var nt=p.filter(function(n){return!n.disabled}).map(function(n){return n.data}),w,b,k,tt,d,g;l.domain(d3.extent(d3.merge(nt),function(n){return n[0]})).range([0,i-t.left-t.right]);o.domain(d3.extent(d3.merge(nt),function(n){return n[1]})).range([u-t.top-t.bottom,0]);e.width(i-t.left-t.right).height(u-t.top-t.bottom).color(p.map(function(n,t){return n.color||f[t%10]}).filter(function(n,t){return!p[t].disabled}));a.ticks(i/100).tickSize(-(u-t.top-t.bottom),0);v.ticks(u/36).tickSize(-(i-t.right-t.left),0);w=d3.select(this).selectAll("g.wrap").data([p]);b=w.enter().append("g").attr("class","wrap d3lineWithLegend").append("g");b.append("g").attr("class","legendWrap");b.append("g").attr("class","x axis");b.append("g").attr("class","y axis");b.append("g").attr("class","linesWrap");r.dispatch.on("legendClick",function(t){t.disabled=!t.disabled;p.filter(function(n){return!n.disabled}).length||p.forEach(function(n){n.disabled=!1});y.transition().call(n)});r.dispatch.on("legendMouseover",function(t){t.hover=!0;y.transition().call(n)});r.dispatch.on("legendMouseout",function(t){t.hover=!1;y.transition().call(n)});e.dispatch.on("pointMouseover.tooltip",function(n){c.showTooltip({point:n.point,series:n.series,pos:[n.pos[0]+t.left,n.pos[1]+t.top],seriesIndex:n.seriesIndex,pointIndex:n.pointIndex})});e.dispatch.on("pointMouseout.tooltip",function(n){c.hideTooltip(n)});r.color(f).width(i/2-t.right);w.select(".legendWrap").datum(p).attr("transform","translate("+(i/2-t.left)+","+-r.height()+")").call(r);t.top=r.height();k=w.select("g").attr("transform","translate("+t.left+","+t.top+")");tt=w.select(".linesWrap").datum(p.filter(function(n){return!n.disabled}));d3.transition(tt).call(e);d=k.select(".x.axis").selectAll("text.axislabel").data([s||null]);d.enter().append("text").attr("class","axislabel").attr("text-anchor","middle").attr("x",l.range()[1]/2).attr("y",t.bottom-20);d.exit().remove();d.text(function(n){return n});k.select(".x.axis").attr("transform","translate(0,"+o.range()[0]+")").call(a).selectAll("line.tick").filter(function(n){return!n}).classed("zero",!0);g=k.select(".y.axis").selectAll("text.axislabel").data([h||null]);g.enter().append("text").attr("class","axislabel").attr("transform","rotate(-90)").attr("text-anchor","middle").attr("y",20-t.left);g.exit().remove();g.attr("x",-o.range()[0]/2).text(function(n){return n});k.select(".y.axis").call(v).selectAll("line.tick").filter(function(n){return!n}).classed("zero",!0)}),n}var t={top:30,right:10,bottom:40,left:60},i=960,u=500,y=function(){return 2.5},s=!1,h=!1,f=d3.scale.category10().range(),c=d3.dispatch("showTooltip","hideTooltip"),l=d3.scale.linear(),o=d3.scale.linear(),a=d3.svg.axis().scale(l).orient("bottom"),v=d3.svg.axis().scale(o).orient("left"),r=d3Legend().height(30).color(f),e=d3Line();return n.dispatch=c,n.margin=function(i){return arguments.length?(t=i,n):t},n.width=function(t){return arguments.length?(i=t,n):i},n.height=function(t){return arguments.length?(u=t,n):u},n.color=function(t){return arguments.length?(f=t,n):f},n.dotRadius=function(t){return arguments.length?(y=d3.functor(t),e.dotRadius=d3.functor(t),n):y},n.xAxis={},d3.rebind(n.xAxis,a,"tickFormat"),n.xAxis.label=function(t){return arguments.length?(s=t,n):s},n.yAxis={},d3.rebind(n.yAxis,v,"tickFormat"),n.yAxis.label=function(t){return arguments.length?(h=t,n):h},n}